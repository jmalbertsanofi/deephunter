[{"model": "qm.query", "pk": 1, "fields": {"name": "psexec_connect", "description": "Detect psexec network connections", "notes": "- To move around freely without attracting too much attention, attackers often use reliable software (one of the favorites is psexec) that looks normal in an enterprise environment.\r\n- Use the following aggregate to easily group by endpoint: `| group array_agg_distinct(dst.ip.address) by endpoint.name, src.process.cmdline`", "pub_date": "2023-03-16T08:02:46.204Z", "update_date": "2024-11-26T08:03:25.622Z", "pub_status": "DIST", "confidence": 2, "relevance": 3, "weighted_relevance": 1.5, "query": "endpoint.os = 'windows'\r\nand event.type = 'IP Connect'\r\nand src.process.name matches 'psexec\\\\.exe'", "columns": "| columns event.time, event.type, site.name, agent.uuid, src.process.storyline.id, src.process.user, src.process.uid, src.process.cmdline, src.ip.address, src.port.number, dst.ip.address, dst.port.number, src.process.parent.cmdline, tgt.process.cmdline", "emulation_validation": "", "references": "https://theitbros.com/using-psexec-to-run-commands-remotely/\r\nhttps://redcanary.com/blog/threat-hunting-psexec-lateral-movement/", "star_rule": false, "run_daily": true, "dynamic_query": false, "anomaly_threshold_count": 2, "anomaly_threshold_endpoints": 2, "tags": [1, 4], "mitre_techniques": [99, 9], "threats": [], "actors": [], "target_os": [1], "vulnerabilities": []}},
{"model": "qm.query", "pk": 2, "fields": {"name": "wsl_kali", "description": "Detect Kali Linux distribution via wsl.exe", "notes": "", "pub_date": "2023-03-16T05:57:24.277Z", "update_date": "2025-01-10T13:53:17.328Z", "pub_status": "DIST", "confidence": 4, "relevance": 1, "weighted_relevance": 1.0, "query": "endpoint.os = 'windows'\r\nand src.process.name matches 'wsl\\\\.exe' \r\nand src.process.parent.name matches 'kali'", "columns": "| columns event.time, event.type, site.name, agent.uuid, src.process.user, src.process.storyline.id, src.process.uid, src.process.cmdline, src.process.parent.cmdline", "emulation_validation": "", "references": "", "star_rule": false, "run_daily": true, "dynamic_query": false, "anomaly_threshold_count": 1, "anomaly_threshold_endpoints": 1, "tags": [1], "mitre_techniques": [72], "threats": [], "actors": [], "target_os": [1], "vulnerabilities": []}},
{"model": "qm.query", "pk": 146, "fields": {"name": "vulnerable_driver_name_detected_loldriver", "description": "Living Off The Land Drivers is a curated list of Windows drivers used by adversaries to bypass security controls and carry out attacks. The project helps security professionals stay informed and mitigate potential threats.", "notes": "- False positives may occur if one of the vulnerable driver names mentioned above didn't change its name between versions. So always make sure that the driver being loaded is the legitimate one and the non vulnerable version.\r\n- If you experience a lot of FP you could comment the driver name or its exact known legitimate location (when possible), or use the \"file hashes\" instead of the \"name\"", "pub_date": "2023-06-02T09:57:42.613Z", "update_date": "2025-01-12T03:00:05.122Z", "pub_status": "DRAFT", "confidence": 2, "relevance": 3, "weighted_relevance": 1.5, "query": "endpoint.os = 'windows'\n    and event.type = 'Driver Load'\n    and (\n      tgt.file.path contains:anycase ('\\\\elrawdsk.sys', '\\\\AsrSetupDrv103.sys', '\\\\daxin_blank6.sys', '\\\\Se64a.sys', '\\\\PanMonFlt.sys', '\\\\asio.sys', '\\\\t.sys', '\\\\smep_capcom.sys', '\\\\EIO.sys', '\\\\dcr.sys', '\\\\piddrv.sys', '\\\\ALSysIO64.sys', '\\\\ACE-BASE.sys', '\\\\WinFlash64.sys', '\\\\SysDrv3S.sys', '\\\\ni.sys', '\\\\2.sys', '\\\\prokiller64.sys', '\\\\WCPU.sys', '\\\\KApcHelper_x64.sys', '\\\\PanMonFltX64.sys', '\\\\KfeCo11X64.sys', '\\\\AsrDrv106.sys', '\\\\daxin_blank3.sys', '\\\\atillk64.sys', '\\\\EneIo64.sys', '\\\\HOSTNT.sys', '\\\\DBUtilDrv2.sys', '\\\\AsrDrv103.sys', '\\\\bwrsh.sys', '\\\\jnprva.sys', '\\\\BlackBoneDrv10.sys', '\\\\TfSysMon.sys', '\\\\BS_RCIO.sys', '\\\\LgDCatcher.sys', '\\\\AMDPowerProfiler.sys', '\\\\POORTRY1.sys', '\\\\amsdk.sys', '\\\\dbutil.sys', '\\\\kEvP64.sys', '\\\\BS_RCIO64.sys', '\\\\CupFixerx64.sys', '\\\\Bs_Def.sys', '\\\\vboxdrv.sys', '\\\\HwOs2Ec7x64.sys', '\\\\capcom.sys', '\\\\Phymemx64.sys', '\\\\ProtectS.sys', '\\\\msr.sys', '\\\\nt5.sys', '\\\\nstr.sys', '\\\\ASIO32.sys', '\\\\cpuz.sys', '\\\\wantd_3.sys', '\\\\nvflsh64.sys', '\\\\NetFlt.sys', '\\\\TGSafe.sys', '\\\\Dh_Kernel_10.sys', '\\\\EneTechIo64.sys', '\\\\NTIOLib_X64.sys', '\\\\4.sys', '\\\\SSPORT.sys', '\\\\HwRwDrv.sys', '\\\\BSMIx64.sys', '\\\\cpuz141.sys', '\\\\BSMEMx64.sys', '\\\\CorsairLLAccess64.sys', '\\\\BS_Flash64.sys', '\\\\HW.sys', '\\\\NodeDriver.sys', '\\\\gvcidrv64.sys', '\\\\TestBone.sys', '\\\\SANDRA', '\\\\UCOREW64.SYS', '\\\\krpocesshacker.sys', '\\\\ampa.sys', '\\\\t8.sys', '\\\\PanIO.sys', '\\\\AsUpIO.sys', '\\\\WINIODrv.sys', '\\\\nt2.sys', '\\\\ntbios_2.sys', '\\\\WYProxy64.sys', '\\\\cpuz_x64.sys', '\\\\inpoutx64.sys', '\\\\windows-xp-64.sys', '\\\\mJj0ge.sys', '\\\\b3.sys', '\\\\AsrOmgDrv.sys', '\\\\dbutil_2_3.sys', '\\\\wantd_4.sys', '\\\\d.sys', '\\\\CITMDRV_AMD64.sys', '\\\\vmdrv.sys', '\\\\HwOs2Ec10x64.sys', '\\\\amifldrv64.sys', '\\\\daxin_blank1.sys', '\\\\My.sys', '\\\\SysInfo.sys', '\\\\procexp.Sys')\n  or tgt.file.path contains:anycase ('\\\\nt6.sys', '\\\\AsrDrv10.sys', '\\\\libnicm.sys', '\\\\ene.sys', '\\\\ADRMDRVSYS.sys', '\\\\BS_HWMIO64_W10.sys', '\\\\full.sys', '\\\\AsrDrv102.sys', '\\\\0x3440_blacklotus_v2_driver.sys', '\\\\RTCore64.sys', '\\\\elbycdio.sys', '\\\\winio64.sys', '\\\\nt4.sys', '\\\\kbdcap64.sys', '\\\\bw.sys', '\\\\AsrSmartConnectDrv.sys', '\\\\WinIO32B.sys', '\\\\cpupress.sys', '\\\\LHA.sys', '\\\\DirectIo32.sys', '\\\\msrhook.sys', '\\\\NetProxyDriver.sys', '\\\\b.sys', '\\\\nstrwsk.sys', '\\\\wantd_5.sys', '\\\\mimidrv.sys', '\\\\gameink.sys', '\\\\b4.sys', '\\\\BS_RCIOW1064.sys', '\\\\Lurker.sys', '\\\\irec.sys', '\\\\asmmap64.sys', '\\\\fgme.sys', '\\\\mhyprot3.sys', '\\\\ViveRRAudio.sys', '\\\\AsrAutoChkUpdDrv.sys', '\\\\amp.sys', '\\\\d2.sys', '\\\\driver7-x86.sys', '\\\\b1.sys', '\\\\magdrvamd64.sys', '\\\\WinIo64B.sys', '\\\\Agent64.sys', '\\\\AsrDrv101.sys', '\\\\gftkyj64.sys', '\\\\IOMap64.sys', '\\\\CSC.sys', '\\\\superbmc.sys', '\\\\iomem64.sys', '\\\\semav6msr.sys', '\\\\c.sys', '\\\\GVCIDrv64.sys', '\\\\daxin_blank4.sys', '\\\\DirectIo.sys', '\\\\bandai.sys', '\\\\gmer64.sys', '\\\\MsIo64.sys', '\\\\AsrRapidStartDrv.sys', '\\\\zam64.sys', '\\\\ADV64DRV.sys', '\\\\daxin_blank5.sys', '\\\\viragt64.sys', '\\\\goad.sys', '\\\\mydrivers.sys', '\\\\windows8-10-32.sys', '\\\\rtkio64.sys', '\\\\dbk64.sys', '\\\\OpenLibSys.sys', '\\\\BS_I2c64.sys', '\\\\Truesight', '\\\\mhyprot.sys', '\\\\AsrIbDrv.sys', '\\\\MsIo32.sys', '\\\\dkrTK.sys', '\\\\NBIOLib_X64.sys', '\\\\rwdrv.sys', '\\\\TSDRVX64.sys', '\\\\wsdkd.sys', '\\\\daxin_blank.sys', '\\\\mtcBSv64.sys', '\\\\ProcObsrvesx.sys', '\\\\viragt.sys', '\\\\aswArPot.sys', '\\\\BS_HWMIo64.sys', '\\\\SeasunProtect.sys', '\\\\d3.sys', '\\\\wsftprm.sys', '\\\\wantd_2.sys', '\\\\piddrv64.sys', '\\\\Proxy64.sys', '\\\\ncpl.sys', '\\\\ATSZIO.sys', '\\\\sfdrvx32.sys', '\\\\LMIinfo.sys', '\\\\asrdrv104.sys', '\\\\Chaos-Rootkit.sys', '\\\\daxin_blank2.sys', '\\\\PhlashNT.sys', '\\\\amigendrv64.sys', '\\\\81.sys')\n  or tgt.file.path contains:anycase ('\\\\psmounterex.sys', '\\\\netfilterdrv.sys', '\\\\ElbyCDIO.sys', '\\\\otipcibus.sys', '\\\\GLCKIO2.sys', '\\\\PanIOx64.sys', '\\\\NQrmq.sys', '\\\\wantd.sys', '\\\\PcieCubed.sys', '\\\\smep_namco.sys', '\\\\PCHunter.sys', '\\\\AccelLid.sys', '\\\\ntbios.sys', '\\\\telephonuAfY.sys', '\\\\WinTapix.sys', '\\\\BEDAISY.SYS', '\\\\LcTkA.sys', '\\\\rzpnk.sys', '\\\\hw.sys', '\\\\t7.sys', '\\\\POORTRY.sys', '\\\\nscm.sys', '\\\\LenovoDiagnosticsDriver.sys', '\\\\pxitrig64.sys', '\\\\sandra.sys', '\\\\tboflhelper.sys', '\\\\TmComm.sys', '\\\\1.sys', '\\\\nvflash.sys', '\\\\fidpcidrv.sys', '\\\\directio64.sys', '\\\\fidpcidrv64.sys', '\\\\WinIo64C.sys', '\\\\HpPortIox64.sys', '\\\\BS_Def64.sys', '\\\\FairplayKD.sys', '\\\\WinIO32A.sys', '\\\\iQVW64.SYS', '\\\\Monitor_win10_x64.sys', '\\\\Proxy32.sys', '\\\\WinRing0.sys', '\\\\CITMDRV_IA64.sys', '\\\\aswVmm.sys', '\\\\driver7-x86-withoutdbg.sys', '\\\\WinIo64A.sys', '\\\\Afd.sys', '\\\\ndislan.sys', '\\\\echo_driver.sys', '\\\\NICM.SYS', '\\\\80.sys', '\\\\ktgn.sys', '\\\\AMDRyzenMasterDriver.sys', '\\\\physmem.sys', '\\\\eneio64.sys', '\\\\7.sys', '\\\\viraglt64.sys', '\\\\VBoxDrv.sys', '\\\\RwDrv.sys', '\\\\malicious.sys', '\\\\Dh_Kernel.sys', '\\\\kt2.sys', '\\\\wantd_6.sys', '\\\\d4.sys', '\\\\t3.sys', '\\\\bwrs.sys', '\\\\Lv561av.sys', '\\\\Black.sys', '\\\\LgCoreTemp.sys', '\\\\GameTerSafe.sys', '\\\\windows7-32.sys', '\\\\gdrv.sys', '\\\\phymem64.sys', '\\\\windbg.sys', '\\\\fiddrv64.sys', '\\\\NTIOLib.sys', '\\\\Air_SYSTEM10.sys', '\\\\nt3.sys', '\\\\834761775.sys', '\\\\BSMI.sys', '\\\\speedfan.sys', '\\\\POORTRY2.sys', '\\\\Sense5Ext.sys', '\\\\ktes.sys', '\\\\WinIO32.sys', '\\\\etdsupp.sys', '\\\\KfeCo10X64.sys', '\\\\MSqPq.sys', '\\\\NCHGBIOS2x64.SYS', '\\\\VProEventMonitor.sys', '\\\\fiddrv.sys', '\\\\wfshbr64.sys', '\\\\driver7-x64.sys', '\\\\BS_I2cIo.sys', '\\\\VBoxUSB.Sys')\n    )", "columns": "| columns event.time, event.type, endpoint.name, src.process.user, src.process.name, src.process.cmdline, src.process.parent.name, src.process.parent.cmdline, tgt.process.name, tgt.process.cmdline, tgt.file.path, tgt.file.sha256", "emulation_validation": "", "references": "https://www.loldrivers.io/", "star_rule": false, "run_daily": true, "dynamic_query": true, "anomaly_threshold_count": 2, "anomaly_threshold_endpoints": 2, "tags": [], "mitre_techniques": [], "threats": [], "actors": [], "target_os": [1], "vulnerabilities": []}}
]